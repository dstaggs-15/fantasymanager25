<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Aura Fantasy – Players</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b0f17; --card:#131b2a; --muted:#8aa0c7; --accent:#6ee7ff; }
    body{margin:0;background:linear-gradient(180deg,#0b0f17,#0a0d14);color:#e6efff;font-family:system-ui,Inter,Arial}
    .wrap{max-width:1200px;margin:0 auto;padding:28px}
    a{color:#a5d8ff;text-decoration:none} a:hover{text-decoration:underline}
    .toolbar{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    input{background:#0f1522;border:1px solid rgba(255,255,255,.08);border-radius:10px;color:#e6efff;padding:10px 12px;min-width:240px}
    .card{background:#131b2a;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.06);font-size:14px}
    th{text-align:left;color:#8aa0c7}
    .muted{color:#8aa0c7}
    .chip{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:0 0 8px 0">Players</h1>
    <div class="toolbar">
      <a href="./index.html">← Home</a>
      <input id="q" placeholder="Search name or team…" />
      <span id="meta" class="muted"></span>
    </div>

    <div class="card">
      <table id="tbl">
        <thead>
        <tr>
          <th>Name</th>
          <th>Position</th>
          <th>Team</th>
          <th>Projected (season)</th>
          <th>Recent avg</th>
          <th class="muted">Source</th>
        </tr>
        </thead>
        <tbody id="rows"><tr><td class="muted" colspan="6">Loading…</td></tr></tbody>
      </table>
    </div>
  </div>

  <script>
    const POS = {
      0: "Quarterback", 2: "Running back", 4: "Wide receiver", 6: "Tight end", 16:"Team defense / special teams"
    };
    const NFL = {
      1:"ATL",2:"BUF",3:"CHI",4:"CIN",5:"CLE",6:"DAL",7:"DEN",8:"DET",9:"GB",
      10:"TEN",11:"IND",12:"KC",13:"OAK",14:"LAR",15:"MIA",16:"MIN",17:"NE",
      18:"NO",19:"NYG",20:"NYJ",21:"PHI",22:"ARI",23:"PIT",24:"LAC",25:"SF",
      26:"SEA",27:"TB",28:"WSH",29:"CAR",30:"JAX",33:"BAL",34:"HOU",35:"NO TEAM"
    };

    const fmt = n => (n==null? "–" : (Math.round(n*10)/10).toFixed(1));

    async function load(){
      const url = "./data/players_summary.json?v=" + Date.now();
      const r = await fetch(url);
      const j = await r.json();
      const rows = j.rows || [];
      const meta = document.getElementById('meta');
      meta.textContent = `Loaded ${rows.length} players • ${j.generated_utc || ''}`;

      const tbody = document.getElementById('rows');
      tbody.innerHTML = "";

      for(const p of rows){
        // Handle both private (positionId/proTeamId) and public (position/team) modes
        const pos = p.positionId!=null ? (POS[p.positionId] || `#${p.positionId}`) : (p.position || "–");
        const team = p.proTeamId!=null ? (NFL[p.proTeamId] || `#${p.proTeamId}`) : (p.team || "–");

        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.name || "?"}</td>
          <td>${pos}</td>
          <td>${team}</td>
          <td>${fmt(p.proj_season)}</td>
          <td>${fmt(p.recent_avg)}</td>
          <td><span class="chip">${p.source || 'n/a'}</span></td>
        `;
        tbody.appendChild(tr);
      }

      // Simple client-side search
      const q = document.getElementById('q');
      q.oninput = () => {
        const term = q.value.toLowerCase();
        for(const tr of tbody.querySelectorAll('tr')){
          const txt = tr.textContent.toLowerCase();
          tr.style.display = txt.includes(term) ? "" : "none";
        }
      };
    }

    load().catch(e=>{
      const tbody = document.getElementById('rows');
      tbody.innerHTML = `<tr><td class="muted" colspan="6">Error: ${e}</td></tr>`;
    });
  </script>
</body>
</html>
