<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fantasy Manager 25</title>
  <style>
    :root { --bg:#f6f7f9; --card:#fff; --text:#1f2937; --muted:#6b7280; --border:#e5e7eb; --headbg:#111827; --headfg:#fff; }
    * { box-sizing: border-box; }
    body { margin:0; padding:24px 16px; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .container { max-width: 980px; margin: 0 auto; }
    h1 { margin: 0 0 8px; text-align:center; }
    .status { text-align:center; color:var(--muted); margin: 6px 0 16px; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; box-shadow:0 1px 3px rgba(0,0,0,.06);}
    table { width:100%; border-collapse: collapse; }
    thead th { background:var(--headbg); color:var(--headfg); font-weight:600; letter-spacing:.01em; }
    th, td { padding:10px 8px; text-align:center; border-bottom:1px solid var(--border); }
    tbody tr:hover { background:#fafafa; }
    .hidden { display:none; }
    .error { color:#b91c1c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fantasy Manager 25</h1>
    <div class="status" id="lastUpdate">Loading last update time…</div>

    <div class="card">
      <table id="standingsTable" aria-label="League Standings">
        <thead>
          <tr>
            <th>Team</th>
            <th>Wins</th>
            <th>Losses</th>
            <th>Points For</th>
            <th>Points Against</th>
          </tr>
        </thead>
        <tbody id="standingsBody"></tbody>
      </table>
      <div id="emptyState" class="status hidden">No data found in <code>data/latest.json</code>.</div>
      <div id="errorState" class="status error hidden">Error loading <code>data/latest.json</code>. Check Actions/logs.</div>
    </div>

    <div class="status">Serving static JSON from <code>/docs/data/latest.json</code></div>
  </div>

  <script>
    // Robust loader that handles a few possible JSON shapes.
    async function loadData() {
      const lastEl = document.getElementById('lastUpdate');
      const bodyEl = document.getElementById('standingsBody');
      const emptyEl = document.getElementById('emptyState');
      const errEl = document.getElementById('errorState');

      try {
        const res = await fetch('data/latest.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const raw = await res.json();

        // Accept either:
        // 1) array of teams [{team, wins, losses, pointsFor, pointsAgainst}]
        // 2) {standings: [...]}
        // 3) {teams: [...]}    (fallback)
        const rows = Array.isArray(raw) ? raw
                   : Array.isArray(raw.standings) ? raw.standings
                   : Array.isArray(raw.teams) ? raw.teams
                   : [];

        // Update "last updated"
        const ts = raw.last_updated || raw.generated_utc || new Date().toISOString();
        lastEl.textContent = `Last updated (UTC): ${ts}`;

        // Render rows
        bodyEl.innerHTML = '';
        if (!rows.length) {
          emptyEl.classList.remove('hidden');
          return;
        }
        emptyEl.classList.add('hidden');

        for (const t of rows) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${t.team || t.name || '—'}</td>
            <td>${t.wins ?? '—'}</td>
            <td>${t.losses ?? '—'}</td>
            <td>${t.pointsFor ?? t.points_for ?? '—'}</td>
            <td>${t.pointsAgainst ?? t.points_against ?? '—'}</td>
          `;
          bodyEl.appendChild(tr);
        }
      } catch (e) {
        console.error(e);
        errEl.classList.remove('hidden');
        lastEl.textContent = 'Last updated: (failed to load)';
      }
    }

    document.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>
